{% load widget_tweaks %}

<div class="mb-3">
  <label for="{{ field.id_for_label }}" class="form-label"><i class="fas fa-lock"></i> {{ label }}</label>
  <div class="input-group">
    {% if field.errors %}
      {{ field|add_class:'form-control is-invalid'|attr:'type:password' }}
    {% else %}
      {{ field|add_class:'form-control'|attr:'type:password' }}
    {% endif %}
    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword(this)"><i class="fas fa-eye"></i></button>
  </div>
  {% if field.errors %}
    <div class="invalid-feedback d-block">
      {% if show_help_text %}
        <ul class="mb-0">
          <li>密碼不能與使用者名稱太相似</li>
          <li>密碼至少要有 8 個字元</li>
          <li>密碼不能是常見的密碼</li>
          <li>密碼不能全是數字</li>
        </ul>
      {% else %}
        {% for error in field.errors %}
          {{ error }}
        {% endfor %}
      {% endif %}
    </div>
  {% endif %}
</div>

<script>
  function togglePassword(button) {
    const input = button.parentElement.querySelector('input')
    const icon = button.querySelector('i')
  
    if (input.type === 'password') {
      input.type = 'text'
      icon.classList.remove('fa-eye')
      icon.classList.add('fa-eye-slash')
    } else {
      input.type = 'password'
      icon.classList.remove('fa-eye-slash')
      icon.classList.add('fa-eye')
    }
  }
</script>
